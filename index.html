<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Accountability → Weekly Dashboard</title>
    <link rel="stylesheet" href="styles.css" />

</head>
<body>
<noscript><div class="wrap"><div class="card">This app requires JavaScript to run.</div></div></noscript>
<div class="wrap">
  <div class="card">
    <div class="row settingsHeader">
      <div>
        <h1>Daily Accountability → Weekly Dashboard</h1>
        <p class="sub">Daily entry, weekly aggregation, local-only storage, JSON exports.</p>
      </div>
      <div class="settingsButtonWrap">
        <button id="openSettingsBtn" class="ghost">Settings</button>
      </div>
    </div>
    <div class="muted" id="weekLabel"></div>
  </div>

  <div class="twoCols">
    <div class="card">
      <h2>Daily entry</h2>
      <div class="row">
        <div>
          <label for="dayDate">Day</label>
          <input id="dayDate" type="date" />
          <div class="small">Pick any day; the dashboard snaps to that week (Mon–Sun).</div>
        </div>
        <div class="small">Daily metrics are generated from active metric definitions for the selected date.</div>
      </div>

      <div class="hr"></div>

      <div id="metricsForm"></div>

      <div class="hr"></div>

      <h3>Weekly structure (tick these any day, but they apply to the week)</h3>
      <div class="checks">
        <div class="check">
          <input id="prioritiesDefined" type="checkbox" />
          <label for="prioritiesDefined" style="margin:0;">3 priorities defined</label>
        </div>
        <div class="check">
          <input id="twoCompleted" type="checkbox" />
          <label for="twoCompleted" style="margin:0;">2 completed</label>
        </div>
        <div class="check">
          <input id="weeklyReviewDone" type="checkbox" />
          <label for="weeklyReviewDone" style="margin:0;">Weekly review done</label>
        </div>
      </div>

      <div class="btns">
        <button id="saveDayBtn">Save day</button>
        <button id="deleteDayBtn" class="danger">Delete this day</button>
        <button id="clearBtn" class="ghost">Clear form</button>
        <span class="pill" id="daySavedPill">Not saved</span>
      </div>
      <div class="footer" id="status"></div>
    </div>

    <div class="card">
      <h2>Weekly dashboard (quick glance)</h2>
      <div class="muted" id="dashWeekRange"></div>
      <div class="hr"></div>

      <div class="gridDash">
        <div class="dashItem">
          <div class="dashK">Sleep avg</div>
          <div class="dashV" id="dashSleep">—</div>
          <div class="dashS" id="dashSleepS">days logged: —</div>
        </div>
        <div class="dashItem">
          <div class="dashK">Caffeine avg</div>
          <div class="dashV" id="dashCaff">—</div>
          <div class="dashS" id="dashCaffS">days logged: —</div>
        </div>
        <div class="dashItem">
          <div class="dashK">Sugar binge days</div>
          <div class="dashV" id="dashSugar">—</div>
          <div class="dashS">count of days ticked</div>
        </div>
        <div class="dashItem">
          <div class="dashK">Movement days</div>
          <div class="dashV" id="dashMove">—</div>
          <div class="dashS">count of days ticked</div>
        </div>

        <div class="dashItem">
          <div class="dashK">DW tech total</div>
          <div class="dashV" id="dashDWTech">—</div>
          <div class="dashS">sessions this week</div>
        </div>
        <div class="dashItem">
          <div class="dashK">DW creative total</div>
          <div class="dashV" id="dashDWCreat">—</div>
          <div class="dashS">sessions this week</div>
        </div>
        <div class="dashItem">
          <div class="dashK">Structure</div>
          <div class="dashV" id="dashStruct">—</div>
          <div class="dashS" id="dashStructS">0/3</div>
        </div>
        <div class="dashItem">
          <div class="dashK">Days logged</div>
          <div class="dashV" id="dashDays">—</div>
          <div class="dashS">out of 7</div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="btns">
        <button id="exportWeekBtn">Export this week JSON</button>
        <button id="exportAllBtn" class="ghost">Export ALL data JSON</button>
        <label class="pill" style="cursor:pointer;">
          Import JSON
          <input id="importFile" type="file" accept="application/json" style="display:none;">
        </label>
      </div>
      <div class="small muted">Weekly export includes summary + raw daily entries. Use it as your “accountability proof”.</div>

      <div class="hr"></div>

      <h3>This week’s days</h3>
      <div style="overflow:auto;">
        <table id="weekDaysTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Sleep</th>
              <th>Caff</th>
              <th>Sugar</th>
              <th>Move</th>
              <th>DW T</th>
              <th>DW C</th>
              <th>Artifacts</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </div>
  </div>

  <div class="card">
    <h2>Weekly history (latest 10)</h2>
    <div class="muted">Click a week to jump your dashboard to it.</div>
    <div class="hr"></div>
    <div style="overflow:auto;">
      <table id="weeksTable">
        <thead>
          <tr>
            <th>Week</th>
            <th>Days</th>
            <th>Sleep avg</th>
            <th>Caff avg</th>
            <th>Sugar</th>
            <th>Move</th>
            <th>DW Tech</th>
            <th>DW Creat</th>
            <th>Structure</th>
            <th class="right">Export</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <dialog id="settingsModal" class="settingsModal">
    <form method="dialog" class="settingsModalCard">
      <div class="settingsTopBar">
        <h2>Settings</h2>
        <button id="closeSettingsBtn" type="submit" class="ghost">Close</button>
      </div>
      <div class="settingsTabs" role="tablist" aria-label="Settings tabs">
        <button type="button" class="tabBtn active" id="generalSettingsTab" data-tab="general">General settings</button>
        <button type="button" class="tabBtn" id="metricSettingsTab" data-tab="metrics">Metric settings</button>
      </div>

      <div id="generalSettingsPanel" class="settingsPanel" role="tabpanel" aria-labelledby="generalSettingsTab">
        <p class="muted">General settings are app-wide behaviors and data portability actions.</p>
        <div class="small">Tip: data remains local in browser storage unless you export and share JSON manually.</div>
      </div>

      <div id="metricSettingsPanel" class="settingsPanel hidden" role="tabpanel" aria-labelledby="metricSettingsTab">
        <p class="muted">Changes are forward-only: edits and removals can only start from today or later, preserving historical records.</p>
        <div class="row3">
          <div>
            <label for="metricEffectiveDate">Effective from</label>
            <input id="metricEffectiveDate" type="date" />
          </div>
          <div>
            <label for="metricEditorMode">Editor mode</label>
            <select id="metricEditorMode">
              <option value="create">Create new metric/version</option>
              <option value="edit">Edit selected metric/version</option>
            </select>
          </div>
          <div>
            <label for="metricRetireDate">Remove effective date</label>
            <input id="metricRetireDate" type="date" />
          </div>
        </div>

        <div class="row3">
          <div>
            <label for="metricIdInput">Metric ID</label>
            <input id="metricIdInput" type="text" placeholder="e.g., hydration_liters" />
          </div>
          <div>
            <label for="metricLabelInput">Name</label>
            <input id="metricLabelInput" type="text" placeholder="Human-readable metric name" />
          </div>
          <div>
            <label for="metricTypeInput">Type of metric</label>
            <select id="metricTypeInput"></select>
          </div>
        </div>

        <div class="row3">
          <div>
            <label for="metricGroupInput">Grouping</label>
            <input id="metricGroupInput" type="text" list="metricGroupList" placeholder="Select or type a new group" />
            <datalist id="metricGroupList"></datalist>
          </div>
          <div>
            <label for="metricUnitInput">Unit (optional)</label>
            <input id="metricUnitInput" type="text" placeholder="e.g., hours, sessions" />
          </div>
          <div>
            <label for="metricAggregationInput">Aggregation</label>
            <select id="metricAggregationInput">
              <option value="average">average</option>
              <option value="sum">sum</option>
              <option value="count_true">count_true</option>
              <option value="count_selected">count_selected</option>
              <option value="latest">latest</option>
              <option value="none">none</option>
            </select>
          </div>
        </div>

        <div class="btns">
          <button id="saveMetricBtn" type="button">Save metric change</button>
          <button id="clearMetricEditorBtn" type="button" class="ghost">Clear editor</button>
          <button id="removeMetricBtn" type="button" class="danger">Remove selected metric</button>
        </div>

        <div class="hr"></div>
        <div style="overflow:auto; max-height: 280px;">
          <table id="metricsTable">
            <thead>
              <tr>
                <th>Metric ID</th>
                <th>Label</th>
                <th>Type</th>
                <th>Group</th>
                <th>Active from</th>
                <th>Active to</th>
                <th class="right">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </form>
  </dialog>
</div>

  <script src="app.js" defer></script>
</body>
</html>
